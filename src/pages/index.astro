---
import BasicLayout from "../layouts/BasicLayout.astro";
import Title from "../components/Title.astro";
import Socials from "../components/Socials.astro";
import List from "../components/List.astro";
import { getCollection } from "astro:content";
import { TITLE } from "../GLOBALS.astro";

let socials = [
	{ title: "mail [at] linussilbertein [dot] de", link: "" , bold: true},
	{ title: "Posts", link: "/posts" },
	{ title: "Tags", link: "/tags" },
];

const allBlogEntries = await getCollection("post");

const allBlogEntriesGroupedByYear = allBlogEntries.reduce((acc, post) => {
	const year = new Date(post.data.date).getFullYear();
	if (!acc[year]) {
		acc[year] = [];
	}
	acc[year].push(post);
	return acc;
}, {});

const sortedYears = Object.keys(allBlogEntriesGroupedByYear).sort(
	(a, b) => Number(b) - Number(a),
);
---

<BasicLayout title={TITLE}>
	<Title title={TITLE.toUpperCase()} />
	{
		sortedYears.map((year) => (
			<List
				items={allBlogEntriesGroupedByYear[year].sort(
					(a, b) => b.data.date.valueOf() - a.data.date.valueOf(),
				)}
				type="posts"
				title={year}
			/>
		))
	}
	<Socials socials={socials} />
</BasicLayout>
